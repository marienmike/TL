<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Frise Chronologique</title>
  <script src="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <link href="https://unpkg.com/vis-timeline/styles/vis-timeline-graph2d.min.css" rel="stylesheet">
  <style>
  body {
    font-family: Arial, sans-serif;
    margin: 30px;
  }
  #timeline {
    width: 100%;
    height: 400px;
    border: 1px solid lightgray;
  }
  /* Centrage des boutons et cases à cocher */
  .centered {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  /* Style des boutons */
  .custom-btn {
    background: #4da6ff;
    color: #fff;
    border: none;
    border-radius: 12px;
    padding: 14px 28px;
    font-size: 1.1em;
    cursor: pointer;
    margin: 5px 8px;
    transition: background 0.2s, transform 0.2s;
    box-shadow: 0 2px 8px #0001;
  }
  .custom-btn:hover, .custom-btn:focus {
    background: #1e90ff;
    transform: translateY(-2px) scale(1.04);
    outline: none;
  }
  /* Style des cases à cocher */
  .custom-checkbox label {
    font-size: 1.1em;
    margin: 0 12px;
    cursor: pointer;
  }
  .custom-checkbox input[type="checkbox"] {
    transform: scale(1.3);
    margin-right: 6px;
    accent-color: #4da6ff;
    vertical-align: middle;
  }
  /* Rouge pour Moyen Âge : range */
.vis-range.group-ma {
  background: #e74c3c !important;
  border-color: #c0392b !important;
  color: #fff !important;
}
/* Vert pour Contemporaine : range */
.vis-range.group-co {
  background: #27ae60 !important;
  border-color: #1e8449 !important;
  color: #fff !important;
}
/* Point Moyen Âge */
.vis-item.group-ma.vis-point {
  background: transparent !important;
  border: none !important;
}
.vis-item.group-ma.vis-point .vis-item-content {
  color: #e74c3c !important;
}
.vis-item.group-ma.vis-point .vis-point {
  background: #e74c3c !important;
  border-color: #c0392b !important;
}
/* Point Contemporaine */
.vis-item.group-co.vis-point {
  background: transparent !important;
  border: none !important;
}
.vis-item.group-co.vis-point .vis-item-content {
  color: #27ae60 !important;
}
.vis-item.group-co.vis-point .vis-point {
  background: #27ae60 !important;
  border-color: #1e8449 !important;
}
  </style>
</head>
<body>
<h2>Frise Chronologique (100 à 2000)</h2>
<p style="text-align:center;">Utilisez Ctrl + molette pour zoomer / dézoomer. Glissez pour naviguer dans le temps.</p>
<div id="timeline"></div>

<!-- Centrage des boutons -->
<div class="centered">
  <button id="editBtn" class="custom-btn">Editer l'événement</button>
  <button id="exportBtn" class="custom-btn">Exporter la frise</button>
  <button id="fitBtn" class="custom-btn">Ajuster</button>
  <button id="focusBtn" class="custom-btn">Centrer sur sélection</button>
</div>
<!-- Centrage des cases à cocher -->
<div id="group-filters" class="centered custom-checkbox">
  <label><input type="checkbox" id="group1" checked> Moyen Âge</label>
  <label><input type="checkbox" id="group2" checked> Contemporaine</label>
</div>

<script>
// Groupes d'événements
const allGroups = [
  { id: 1, content: "Moyen Âge" },
  { id: 2, content: "Contemporaine" }
];
const groups = new vis.DataSet(allGroups);

  // Evénements
  const data = [
    { id: 4, content: 'Couronnement de Charlemagne', start: '0800-12-25', type: 'point', group: 1 },
    { id: 5, content: 'Découverte de l’Amérique', start: '1492-10-12', type: 'point', group: 1 },
    { id: 6, content: 'Révolution française', start: '1789-07-14', end: '1799-11-09', type: 'range', group: 2 },
    { id: 7, content: 'Débarquement en Normandie', start: '1944-06-06', type: 'point', group: 2 },
    { id: 8, content: 'Prise de Grenade', start: '1492-12-12', type: 'point', group: 1 }
  ];

  // Ajout automatique de la mise en forme (className) selon le groupe
  data.forEach(ev => {
    if (ev.group === 1) ev.className = 'group-ma';
    else if (ev.group === 2) ev.className = 'group-co';
  });
  const items = new vis.DataSet(data);

  // Options de configuration
  const options = {
    min: '700-01-01',
    max: '2020-12-31',
    zoomable: true,
    zoomKey: 'ctrlKey', // Nécessite CTRL pour zoomer (évite les conflits de scroll)
    zoomMin: 1000 * 60 * 60 * 24 * 30,       // Zoom minimum : 1 mois
    zoomMax: 1000 * 60 * 60 * 24 * 365 * 5000, // Zoom maximum : ~5000 ans
    orientation: 'bottom',
    editable: {
      add: false,         // add new items by double tapping
      updateTime: false,  // drag items horizontally
      updateGroup: true, // drag items from one group to another
      remove: true,       // delete an item by tapping the delete button top right
      overrideItems: false  // allow these options to override item.editable
    },
    stack: true,
    groupHeightMode: 'fitiItems',
    format: {
      minorLabels: {
        day: 'D MMM YYYY'
      },
      majorLabels: {
        year: 'YYYY'
      }
    },
    tooltip: {
      followMouse: true,
      template: function (item) {
        function formatDateDMY(dateStr) {
          if (!dateStr) return "";
          const d = new Date(dateStr);
          const day = String(d.getDate()).padStart(2, '0');
          const month = String(d.getMonth() + 1).padStart(2, '0');
          const year = d.getFullYear();
          return `${day}-${month}-${year}`;
        }
        function formatYear(dateStr) {
          if (!dateStr) return "";
          return new Date(dateStr).getFullYear();
        }
        let html = `<strong>${item.content}</strong><br>`;
        if (item.type === 'range' && item.start && item.end) {
          html += `${formatYear(item.start)} - ${formatYear(item.end)}`;
        } else if (item.start) {
          html += formatDateDMY(item.start);
        }
        return html;
      }
    }
  };

  // Conteneur de la frise
  const container = document.getElementById('timeline');
  const timeline = new vis.Timeline(container, items, groups, options);

  // Bouton d'édition
  document.getElementById('editBtn').onclick = function() {
    const sel = timeline.getSelection();
    if (!sel.length) {
      alert("Sélectionnez un événement à éditer.");
      return;
    }
    const id = sel[0];
    const item = items.get(id);
    const newText = prompt("Edit items text:", item.content);
    if (newText !== null) {
      items.update({ id: id, content: newText });
    }
  };

  // Bouton d'export
  document.getElementById('exportBtn').onclick = function() {
    const data = items.get();
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "events.json";
    a.click();
    URL.revokeObjectURL(url);
  };

  // Bouton ajuster
  document.getElementById('fitBtn').onclick = function() {
    timeline.fit();
  };

  // Bouton focus : centre le zoom sur les éléments sélectionnés
  document.getElementById('focusBtn').onclick = function() {
    const selection = timeline.getSelection();
    if (!selection.length) {
      alert("Sélectionnez au moins un événement à centrer.");
      return;
    }
    timeline.focus(selection, { animation: true }, zoom = false);
  };

// Gestion du double-clic pour ajouter un événement à une date choisie
timeline.on('doubleClick', function (props) {
  // Pré-remplissage de la date de début
  const defaultStart = props.time ?
    `${String(props.time.getDate()).padStart(2, '0')}-${String(props.time.getMonth() + 1).padStart(2, '0')}-${props.time.getFullYear()}` : "";

  // Demande toutes les infos dans une seule pop-up
  const saisie = prompt(
    "Saisir : nom;date début JJ-MM-AAAA;date fin JJ-MM-AAAA (optionnelle)\nExemple : Guerre de Cent Ans;17-07-1453;19-10-1453",
    `;${defaultStart};`
  );
  if (!saisie) return;

  // Découpe la saisie
  const [content, startStr, endStr] = saisie.split(";").map(s => s.trim());
  if (!content || !startStr) {
    alert("Le nom et la date de début sont obligatoires !");
    return;
  }

  // Demande le groupe (optionnel)
  let group = props.group;
  if (!group) {
    group = prompt("Numéro du groupe (1 = Moyen Âge, 2 = Contemporaine) :", "1");
    if (!group) return;
    group = parseInt(group, 10);
  }

  // Conversion JJ-MM-AAAA -> AAAA-MM-JJ
  function toISO(dateStr) {
    if (!dateStr) return "";
    const [day, month, year] = dateStr.split("-");
    return `${year}-${month}-${day}`;
  }

  // Génère un nouvel id unique
  const maxId = Math.max(...items.get().map(ev => ev.id), 0);

  // Ajoute l'événement, type selon présence de endStr
  const event = {
    id: maxId + 1,
    content: content,
    start: toISO(startStr),
    group: group
  };
  if (endStr) {
    event.end = toISO(endStr);
    event.type = 'range';
  } else {
    event.type = 'point';
  }

  // Ajoute la classe pour le groupe
  event.className = group === 1 ? 'group-ma' : (group === 2 ? 'group-co' : '');
  items.add(event);
});

// Gestion des cases à cocher pour afficher/masquer les groupes
function updateGroups() {
  const showGroups = [];
  if (document.getElementById('group1').checked) showGroups.push(1);
  if (document.getElementById('group2').checked) showGroups.push(2);

  // Si aucune case cochée, on masque tout
  if (showGroups.length === 0) {
    timeline.setGroups([]);
    return;
  }

  // On filtre les objets groupes à afficher
  const filteredGroups = allGroups.filter(g => showGroups.includes(g.id));
  timeline.setGroups(filteredGroups);
}

document.getElementById('group1').addEventListener('change', updateGroups);
document.getElementById('group2').addEventListener('change', updateGroups);

updateGroups();
</script>
</body>
</html>
